import{L as G,s as b,r as l,M as C,y as E,N as O}from"./BoVHPEzE.js";const L=G("Orders",()=>{const h=E(),{errorMessage:u,success:I}=b(),w=l([]),o=l(!1),m=l(!1),y=l(!1),x="https://flancedelivery.runasp.net/api/Files/GetFileStreamById?id=",d=l([]);async function D(c="",n=null,f="",p="",S="",g="",t=null,v=!1){var i,r;m.value=!0;try{const e=await C.get(h.public.apiBase+"Order/GetOrderPaged",{params:{page:1,pageSize:500,SearchKeyword:c,OrderStatus:n,ClientID:f,DeliveryAddressID:p,DriverID:S,StoreId:g}});if(e.data&&(e.data.code===0||e.data.code===200)){let s=e.data.data.entities;n===""&&t==="ServiceProvider"?s=s.filter(a=>a.orderStatus!==5&&a.orderStatus!==0&&a.orderStatus!==6):v&&t==="Client"?s=s.filter(a=>a.orderStatus!==5&&a.orderStatus!==0&&a.orderStatus!==6&&a.orderStatus!==""):n===""&&t==="Driver"&&(s=s.filter(a=>a.orderStatus!==5&&a.orderStatus!==0&&a.orderStatus!==6)),s.sort((a,B)=>B.id-a.id),d.value=s}else d.value=[]}catch(e){console.error(((r=(i=e.response)==null?void 0:i.data)==null?void 0:r.errors)||e)}finally{m.value=!1}}async function M(c,n){var f,p,S,g,t,v,i;y.value=!0,o.value=!1;try{const r=await C.put(h.public.apiBase+`Order/ChnageOrderStatus?Id=${c}&OrderStatus=${n}`);if(r.data&&(r.data.code===0||r.data.code===200)){o.value=!0,I("تم تحديث حالة الطلب");const e=d.value.findIndex(s=>s.orderDetails.some(a=>a.orderID===c));if(e!==-1)return d.value.splice(e,1)[0]}else{o.value=!1;const e=await O((f=r.data)==null?void 0:f.code)||((p=r.data)==null?void 0:p.message);u(e)}}catch(r){if((S=r.response.data)!=null&&S.errors)u((g=r.response.data)==null?void 0:g.errors);else if((t=r.response.data)!=null&&t.code){const e=await O((v=r.response.data)==null?void 0:v.code)||((i=r.response.data)==null?void 0:i.message);u(e)}else{const e=await O();u(e)}o.value=!1}finally{y.value=!1}}return{StoreData:w,loadingStore:m,changeOrderStatueLoading:y,Orders:d,urlImage:x,isSuccess:o,GetOrders:D,ChnageOrderStatus:M}});export{L as u};
