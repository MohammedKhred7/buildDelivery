import{L as U,r as i,M as n,y as H}from"./2_s1o7K9.js";const K=U("Shop",()=>{const s=H(),O=i(null),D="https://flancedelivery.runasp.net/api/Files/GetFileStreamById?id=",y=i([]),o=i(!1);async function w(){var r,e;o.value=!0;try{const t=await n.get(s.public.apiBase+"Store/GetStoresPaged",{params:{page:1,pageSize:10,StoreStatus:2}});t.data&&(t.data.code===0||t.data.code===200)?y.value=t.data.data.entities:y.value=[]}catch(t){(e=(r=t.response)==null?void 0:r.data)!=null&&e.errors?console.log(t.response.data.errors):console.log(t)}finally{o.value=!1}}const v=i([]);async function b(){var r;o.value=!0;try{const e=await n.get(s.public.apiBase+"Store/GetAllStore",null,{});e.data&&e.data.code===0||e.data.code===200?v.value=e.data.data:v.value=[]}catch(e){(r=e.response.data)!=null&&r.errors?console.log(e.response.data.errors):console.log(e)}finally{o.value=!1}}const I=i([]);async function G(){var r;try{const e=await n.get(s.public.apiBase+"Area/GetAllArea",null,{});e.data&&e.data.code===0||e.data.code===200?I.value=e.data.data:I.value=[]}catch(e){(r=e.response.data)!=null&&r.errors?console.log(e.response.data.errors):console.log(e)}}const c=i({infoStore:{},loading:!1,categories:[],products:[]});async function A(r){var e,t;c.value.loading=!0,localStorage.setItem("ItemStore",JSON.stringify(r)),c.value.infoStore=r;try{const a=await n.get(s.public.apiBase+"Offer/GetAllOffer",{params:{StoreId:r.id}});a.data&&(a.data.code===0||a.data.code===200)?a.data.data?(c.value.categories=await P(a.data.data),c.value.products=await B(a.data.data)):(c.value.categories=[{categoryId:0,categoryName:"الكل"}],c.value.products=[]):(c.value.categories=[{categoryId:0,categoryName:"الكل"}],c.value.products=[])}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{c.value.loading=!1}}function P(r){const e=new Map,t=[{categoryId:0,categoryName:"الكل"}];return r.forEach(a=>{e.has(a.categoryId)||(e.set(a.categoryId,a.category.name),t.push({categoryId:a.categoryId,categoryName:a.category.name}))}),t}function B(r){return r.map(e=>{const t=e.discountValue>0?Math.round(e.price/(1-e.discountValue/100)):e.price,a=e.discountValue>0?Math.round(e.price*(1-e.discountValue/100)):e.price;return{areaId:e.areaId,storeId:e.storeId,categoryId:e.categoryId,id:e.id,title:e.title,description:e.description,startDate:e.startDate,endDate:e.endDate,discountValue:e.discountValue,price:e.price,priceBeforeDiscount:t,priceAfterDiscount:a,imagesIds:e.images}})}function T(r,e){return e?r.filter(t=>t.categoryId===e):r}function m(r){return r?r.filter(e=>e.discountValue):[]}function C(r,e="asc"){return[...r].sort((t,a)=>e==="asc"?t.price-a.price:a.price-t.price)}function N(r,e){return r.filter(t=>t.price===e)}const S=i([]);async function V(){var r,e;o.value=!0;try{const t=await n.get(s.public.apiBase+"Offer/GetOfferPaged",{params:{page:1,pageSize:10}});t.data&&(t.data.code===0||t.data.code===200)?S.value=await B(t.data.data.entities):S.value=[]}catch(t){(e=(r=t.response)==null?void 0:r.data)!=null&&e.errors?console.log(t.response.data.errors):console.log(t)}finally{o.value=!1}}async function M(r,e,t,a,u,f){if(!r)throw console.log(r),new Error("Items must be a non-empty array");const p=r[0].storeId||0,g=r.map(d=>({offerId:d.id,productName:d.title,quantity:d.quantity,unitPrice:d.price,discount:d.discountValue||0}));return{clientID:f||0,storeID:p,customerNote:e||"",cancelReason:"",deliveryPrice:0,deliveryAddressID:t||0,orderStatus:0,paymentMethod:a||0,totalAmount:u||0,orderDetails:g}}const l=i(!1);async function x(r){var e,t;o.value=!0;try{const a=await n.post(s.public.apiBase+"Order/CreateOrder",r);a.data&&(a.data.code===0||a.data.code===200)?l.value=!0:l.value=!1}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{o.value=!1}}const h=i([]);async function z(){var r;try{const e=await n.get(s.public.apiBase+"StoreType/GetAllStoreTypes",null,{});e.data&&e.data.code===0||e.data.code===200?h.value=e.data.data:h.value=[]}catch(e){(r=e.response.data)!=null&&r.errors?console.log(e.response.data.errors):console.log(e)}}async function E(r){var e,t;o.value=!0;try{const a=await n.put(s.public.apiBase+"Store/UpdateStore",r);a.data&&(a.data.code===0||a.data.code===200)?l.value=!0:l.value=!1}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{o.value=!1}}async function F(r,e,t){var p,g;const a=((p=r.StoreTypes)==null?void 0:p.id)||0,u=((g=r.selectedArea)==null?void 0:g.id)||0,f=[];return r.openTimes.forEach((d,J)=>{d.from&&d.to&&f.push({from:d.from,to:d.to,day:7,latitude:14.54,longitude:49.13})}),{id:t||null,name:r.name||"",description:r.description||"",phoneNumber:r.phoneNumber||"",imageId:r.imageId||0,addressLine:r.addressLine||"",city:r.city||"",storeStatus:0,storeTypeId:a,areaId:u,serviceProviderId:e||0,openTimes:f}}async function L(r){var e,t;try{const a=await n.get(s.public.apiBase+"Store/GetStoreId",{params:{Id:r}});return a.data&&a.data.code===0||a.data.code===200?a.data.data:[]}catch(a){(e=a.response.data)!=null&&e.errors?console.log((t=a.response.data)==null?void 0:t.errors):console.log(a)}}async function R(r){var e,t;try{const a=await n.get(s.public.apiBase+"Offer/GetOfferById",{params:{Id:r}});return a.data&&a.data.code===0||a.data.code===200?a.data.data:[]}catch(a){(e=a.response.data)!=null&&e.errors?console.log((t=a.response.data)==null?void 0:t.errors):console.log(a)}}async function j(r){var e,t;o.value=!0,delete r.serviceProviderID,delete r.storeId;try{const a=localStorage.getItem("accessToken"),u=await n.post(s.public.apiBase+"Offer/CreateOffer",r,{headers:{Authorization:`Bearer ${a}`}});u.data&&(u.data.code===0||u.data.code===200)?l.value=!0:l.value=!1}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{o.value=!1}}async function k(r){var e,t;o.value=!0;try{const a=await n.put(s.public.apiBase+"Offer/UpdateOffer",r);a.data&&(a.data.code===0||a.data.code===200)?l.value=!0:l.value=!1}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{o.value=!1}}async function q(r){var e,t;o.value=!0;try{const a=await n.delete(s.public.apiBase+"Offer/DeleteOffer",{params:{id:r}});a.data&&(a.data.code===0||a.data.code===200)?l.value=!0:l.value=!1}catch(a){(t=(e=a.response)==null?void 0:e.data)!=null&&t.errors?console.log(a.response.data.errors):console.log(a)}finally{o.value=!1}}return{productForDetilesById:O,allStore:v,StoreData:y,allArea:I,loadingStore:o,urlImage:D,detilesStore:c,offerData:S,sucsses:l,StoreTypes:h,GetAllStore:b,GetPagesStore:w,GetAllArea:G,GetDetilesByIdStore:A,GetOfferPaged:V,sortByPrice:C,filterByRoundedPrice:N,filterByCategory:T,filterHasDiscount:m,PostCreateOrder:x,createOrderObject:M,GetAllStoreTypes:z,buildStoreObject:F,PostCreateStore:E,GetStoreById:L,PostCreateOffer:j,GetOfferById:R,PutCreateOffer:k,DeleteOffer:q}});export{K as u};
